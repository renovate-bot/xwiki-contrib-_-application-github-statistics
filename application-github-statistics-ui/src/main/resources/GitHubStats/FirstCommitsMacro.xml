<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc>
  <web>GitHubStats</web>
  <name>FirstCommitsMacro</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>GitHubStats.WebHome</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1386680029000</creationDate>
  <date>1386681169000</date>
  <contentUpdateDate>1386680029000</contentUpdateDate>
  <version>1.1</version>
  <title>First Commits Macro</title>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <attachment>
    <filename>unknown.png</filename>
    <filesize>2056</filesize>
    <author>xwiki:XWiki.Admin</author>
    <date>1373287535000</date>
    <version>1.1</version>
    <comment/>
    <content>iVBORw0KGgoAAAANSUhEUgAAAIwAAACMCAMAAACZHrEMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJ
bWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdp
bj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6
eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEz
NDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJo
dHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlw
dGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAv
IiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RS
ZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpD
cmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNl
SUQ9InhtcC5paWQ6OTVBNkM2RDU0RjYzMTFFMTgzMjhDMTQwN0NCMDYxRUUiIHhtcE1NOkRvY3Vt
ZW50SUQ9InhtcC5kaWQ6OTVBNkM2RDY0RjYzMTFFMTgzMjhDMTQwN0NCMDYxRUUiPiA8eG1wTU06
RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5NUE2QzZEMzRGNjMxMUUxODMy
OEMxNDA3Q0IwNjFFRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5NUE2QzZENDRGNjMxMUUx
ODMyOEMxNDA3Q0IwNjFFRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1w
bWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvfLyBkAAAAYUExURezs7Nzc3NPT0+Pj48zMzPj4+P//
/8rKyjC5OGcAAARYSURBVHja7JvJduQgDEUfYsj//3FXOjjtAdATQyV9DixSi5TtW5qQhIyPX7Sw
YTbMhtkwG2bDbJhFMOI8EF8rff4BvJMfgQkOMZVWhJe3wjhfBvkH5N4EIwpJ5umRD6zaYUgOnrAS
JngepQcH61D+LhMOD+M6UD6l4+bDCFLvgkyG8WlksbqiYALS2IoyDUZiGl2c5WC1iiyqwnIVfdtx
GIaZxsLQKDAhpnkrhiGYqSw6DUgWAF1gr5TrlHAoNODsJeaEykiS8wiQsmnBnB7te1IIdzxZTlbc
CXOOL2LeMC9BNz5/lg1Gzne2RsFbxD2r13XAXBwJFWN6JbtOsghExLls5veQ4jmXAmEwBdnKqzKp
1CWv+uXxD8cFvxrM5fLUl+yXVd4wG1DRbhQmXC1KbDDgru6EgQlG0lKYmqRBbUmT1VTzKOjWO92A
qzYMaq/2gzCO27/BXJpGuzjPDdaTMKUkJsyGKYoGjGCGjaZQXzgOBh0Jo9mCb3tvDUYKghmNMyVx
CwPjpyupLG8wMHG6L5XdoqB6EFqSGTBPiTsdxq8RTEE00GHiIsE8f2ZUYcIqwRQMQDQYt8SVykL3
Ggxm7wQNPUGDiUyknKSnqMAsNJnCzUMbRtLsVKYldmnDrLRf3YKhhTyZCAMbDN4Kg98EE9swccPQ
MG4hTGrDpPfCBCPMyqBnhsHPwcSlMMlmMzEt3LXDMMzEfEbGYeYFGpdscQYr3Umt43SYuM6ZYE0h
5ukpqEJXk6t5enJWGEkL+iF0eqIm5NO2p6BHDbVUmSYar7uGXsRN2hKEuK1e3k5yKBDq1wt/wyyD
yZWIwv8j9h1J25VEtERqZ35jsimOdhDNIknzacpjJkQb7SNOGZ/SnYJpMDbOZvuEUxuQolqvMmV8
SkMhm9IfzRkDOIOyWvMKXLv+rOIo4XHDSPIokxPkQcbJhL/wnwM9n4faDaIgTpspYY94zqLJB+JF
f4jlaUluzpE9/Lr0srMHOT4sU4NR/LHg9dGu5vC1LYIZR+IPTG+3k8oTxLIR9R8lX2/3daUYkhx1
psVyyH6LNSiajZgyzIHxg5tWSmYDYyY1MJhxlUOOlpcBJ2/fGtUEnxvmyZd/z0pr4+rSoyT7mJO4
1zqR+KPzkkWiG03PmNP110n1S1eY/MXQYTBNmIviaz/H32F8rR3HVIQgyy7UGgs3mKjANO2e9lBf
6dLVPnvGcNuDptDu84QILRj0D5reaEoZgw1maAT3kQ/Ay2dSJeLRAYOx4eRGdmKHGR7brm/BZpgJ
A+3VjcYKw3Scul+CsMFw9V/36yEmGHDFFtmUeo5HW2DYpiDbIXsIh4cBXYN2v2zFwli6BZbe4QWH
g4mmtq2tkXnCYWAWvqD3Vc1HCib+bViYO6KdzZ94ZHTH5yERyaHpDS91Hs2ObAsuQ8kBEYd6+2PN
b+Scyx2xBEPd9CGY4HMMwZGXylC/eL/JvmE2zIbZMBtmw/wvMH8EGAAJifrfoartVwAAAABJRU5E
rkJggg==
</content>
  </attachment>
  <object>
    <class>
      <name>XWiki.WikiMacroClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <code>
        <disabled>0</disabled>
        <name>code</name>
        <number>9</number>
        <prettyName>Macro code</prettyName>
        <rows>20</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </code>
      <contentDescription>
        <disabled>0</disabled>
        <name>contentDescription</name>
        <number>8</number>
        <prettyName>Content description (Not applicable for "No content" type)</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </contentDescription>
      <contentType>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>contentType</name>
        <number>7</number>
        <prettyName>Macro content type</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Optional|Mandatory|No content</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </contentType>
      <defaultCategory>
        <disabled>0</disabled>
        <name>defaultCategory</name>
        <number>4</number>
        <prettyName>Default category</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultCategory>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>3</number>
        <prettyName>Macro description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <id>
        <disabled>0</disabled>
        <name>id</name>
        <number>1</number>
        <prettyName>Macro id</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </id>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>2</number>
        <prettyName>Macro name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
      <supportsInlineMode>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>supportsInlineMode</name>
        <number>5</number>
        <prettyName>Supports inline mode</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </supportsInlineMode>
      <visibility>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>visibility</name>
        <number>6</number>
        <prettyName>Macro visibility</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator>|</separator>
        <separators>|</separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>Current User|Current Wiki|Global</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </visibility>
    </class>
    <name>GitHubStats.FirstCommitsMacro</name>
    <number>0</number>
    <className>XWiki.WikiMacroClass</className>
    <guid>579c92c6-f1de-4772-9847-09641c629058</guid>
    <property>
      <code>{{velocity}}
##============================
## Get all commits for the specified parameters
##============================
#set ($repositories = $services.githubstats.getRepositories($xcontext.macro.params.repositories))
#if ($repositories.isEmpty())
  {{error}}Invalid 'repositories' parameter value. Make sure the format is '&lt;organization1&gt;/&lt;repository1&gt;,...,&lt;organizationN&gt;/&lt;repositoryN&gt;' and that the organization and repositories specified exist.{{/error}}
#end
#set ($userCommitActivity = $services.git.countAuthorCommits(0, $repositories))
##================================
## Get all imported users and their aliases in the wiki
##================================
#set ($authors = $services.githubstats.getAuthorsForRepositories($xcontext.macro.params.repositories))
##==========
## Display results
##==========
#set ($joda = $xwiki.jodatime)
#foreach ($data in $userCommitActivity)
  #set ($firstCommitDate = $data.earliest)
  #set ($author = $services.githubstats.buildAuthor($data.name, $data.email))
  #set ($authorData = $authors.get($author))
  #set ($isCommitter = $authorData.committer == 'true')
  #if ($isCommitter || (!$isCommitter &amp;&amp; "$!xcontext.macro.params.contributors" == "true"))
    #set ($avatar = $authorData.avatar)
    #if ("$!avatar" == '')
      #set ($avatarDisplay = "(% style='width:85px' %)[[image:attach:GitHubStats.CommittersMacro@unknown.png||width='80' height='80']]")
    #else
      #set ($avatarDisplay = "(% style='width:85px' %)[[image:${avatar}||width='80' height='80']]")
    #end
    #set ($company = $authorData.company)
    #if ("$!company" != '')
      #set ($companyDisplay = "\\//${company}//")
    #else
      #set ($companyDisplay = '')
    #end
    #if ($isCommitter)
      #set ($backgroundColor = '#E1F7ED')
    #else
      #set ($backgroundColor = '#F7F2E1')
    #end
    #set ($duration = $joda.getDuration($joda.getDateTime($firstCommitDate), $joda.getDateTime()))
    #set ($period = $duration.toPeriodTo($joda.getDateTime()))
    #set ($nameDisplay = "(% style=""background-color: $backgroundColor"" %)(((${authorData.name}$!companyDisplay)))")
    |$avatarDisplay|$nameDisplay|(((${datetool.format('medium', $firstCommitDate)}\\//$period.years years, $period.months months, $period.days days//)))
  #end
#end
{{/velocity}}</code>
    </property>
    <property>
      <contentDescription/>
    </property>
    <property>
      <contentType>No content</contentType>
    </property>
    <property>
      <defaultCategory>content</defaultCategory>
    </property>
    <property>
      <description>List first commit date for Committers</description>
    </property>
    <property>
      <id>firstCommits</id>
    </property>
    <property>
      <name>First Commits</name>
    </property>
    <property>
      <supportsInlineMode>0</supportsInlineMode>
    </property>
    <property>
      <visibility>Current Wiki</visibility>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <name>GitHubStats.FirstCommitsMacro</name>
    <number>1</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>a53e723d-f8be-4777-9ab0-247c72daee96</guid>
    <property>
      <defaultValue>true</defaultValue>
    </property>
    <property>
      <description>If "true" then also lists contributors who've committed through pull requests</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>contributors</name>
    </property>
  </object>
  <object>
    <class>
      <name>XWiki.WikiMacroParameterClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <defaultValue>
        <disabled>0</disabled>
        <name>defaultValue</name>
        <number>4</number>
        <prettyName>Parameter default value</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </defaultValue>
      <description>
        <disabled>0</disabled>
        <name>description</name>
        <number>2</number>
        <prettyName>Parameter description</prettyName>
        <rows>5</rows>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <mandatory>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>yesno</displayType>
        <name>mandatory</name>
        <number>3</number>
        <prettyName>Parameter mandatory</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </mandatory>
      <name>
        <disabled>0</disabled>
        <name>name</name>
        <number>1</number>
        <prettyName>Parameter name</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </name>
    </class>
    <name>GitHubStats.FirstCommitsMacro</name>
    <number>3</number>
    <className>XWiki.WikiMacroParameterClass</className>
    <guid>9c389715-bd37-417c-9a27-e7bab04132fd</guid>
    <property>
      <defaultValue/>
    </property>
    <property>
      <description>Explicit list of repositories to get data for</description>
    </property>
    <property>
      <mandatory>0</mandatory>
    </property>
    <property>
      <name>repositories</name>
    </property>
  </object>
  <content/>
</xwikidoc>
